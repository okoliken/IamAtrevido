<section {...$$restProps}>
  {#if showNavigation}
    <NavigationButton
      type={highlightedStyle}
      {size} action="previous"
      label={previousLabel}
      disabled={current <= 1}
      clickHandler={changePage.bind(null, current-1)}
      ariaLabel={ariaPreviousLabel} />
  {/if}

  {#if simple}
    {current} / {pageCount}
  {:else}
    <ol class="padding-none">
      {#each pages as {idx, show}}
        <li>
          {#if show}
            <Button {size} isLink
                    class={bullets ? 'paper-pagination-btn--rounded' : ''}
                    on:click={changePage.bind(null, idx)}
                    type={idx === current ? highlightedStyle : defaultStyle}
                    aria-label={ariaPageLabel?.(idx) ?? `Page ${idx}`}
                    aria-current={idx === current}>
              {displayedPageLabel(idx)}
            </Button>
          {:else if shouldDisplayEllipsis(idx)}
            â€¦
          {/if}
        </li>
      {/each}
    </ol>
  {/if}

  {#if showNavigation}
    <NavigationButton
      type={highlightedStyle}
      {size} action="next"
      label={nextLabel}
      disabled={current >= pageCount}
      clickHandler={changePage.bind(null, current+1)}
      ariaLabel={ariaNextLabel} />
  {/if}

  {#if jumper}
    <span on:keypress={submitJumper}>
      <Input class="paper-pagination-input"
             bind:value={jumperValue}
             type="number" placeholder="Go to"
             min="1" max={pageCount} step="1" />
    </span>
  {/if}
</section>

<script >import { createEventDispatcher } from 'svelte';
import Button from '../Button.svelte';
import Input from '../Form/Input.svelte';
;
import NavigationButton from './NavigationButton.svelte';
export let total;
export let pageSize = 10;
export let current = 1;
export let size = 'small';
export let navigation = true;
export let simple = false;
export let bullets = false;
export let previousLabel = null;
export let nextLabel = null;
export let highlightedStyle = 'secondary';
export let defaultStyle = null;
export let rangeBetween = null;
export let jumper = false;
export let pageLabel = null;
export let ariaPreviousLabel = 'previous page';
export let ariaNextLabel = 'next page';
export let ariaPageLabel = null;
const dispatch = createEventDispatcher();
let jumperValue;
let pageCount;
$: pageCount = Math.ceil(total / pageSize);
let pages;
$: if (current) {
    pages = Array.from({ length: pageCount }, (_, i) => ({ idx: ++i, show: shouldDisplayButton(i) }));
}
let showNavigation;
$: showNavigation = navigation && !bullets;
function submitJumper({ code }) {
    const toPage = Number(jumperValue);
    if (code !== 'Enter' || pageInvalid(toPage))
        return;
    changePage(toPage);
}
function pageInvalid(idx) {
    return idx < 1 || idx > pageCount || !Number.isInteger(idx);
}
function shouldDisplayButton(idx) {
    if (!rangeBetween || [1, pageCount].includes(idx))
        return true;
    return idx >= (current - rangeBetween)
        && idx <= (current + rangeBetween);
}
function shouldDisplayEllipsis(idx) {
    return pages[idx - 2].show;
}
function changePage(val) {
    if (pageInvalid(val))
        return;
    current = val;
    dispatch('change', current);
}
function displayedPageLabel(idx) {
    var _a;
    if (bullets)
        return '';
    return (_a = pageLabel === null || pageLabel === void 0 ? void 0 : pageLabel(idx)) !== null && _a !== void 0 ? _a : idx;
}
</script>

<style >ol, li {
  display: inline;
}

ol li {
  text-indent: 0;
}
ol li::before {
  content: "";
}

:global(.paper-pagination-input) {
  display: inline;
  width: 4rem;
}

:global(.paper-pagination-btn--rounded) {
  border-radius: 50%;
}</style>
